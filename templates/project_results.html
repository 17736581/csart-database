{% extends "layout.html" %}

{% block head %}
    <script>
        $(document).ready(function() {
            var keyword_wrapper = $(".keyword_container");
            
            $(keyword_wrapper).each(function(){
                $(this).find("span:last").remove();
            });

            $('.btn').click(function() {
                var text = $(this).text()
                if(text === 'Hide Summary'){
                    $(this).html('Show Summary');
                } else {
                    $(this).html('Hide Summary');
                }
            });

            $('.author_btn').click(function() {
                var parent_div = $(this).parent();

                var button_text = $(this).text();
                var points = parent_div.find("#points");
                var more_authors = parent_div.find("#more_authors");
                
                if(button_text === 'Show Less'){
                    $(this).html('Show More');
                    points.show();
                    more_authors.hide();
                } else {
                    $(this).html('Show Less');
                    points.hide();
                    more_authors.show();
                }
            });
        });
    </script>
{% endblock %}

{% block title %}
    Projects
{% endblock %}

{% block main %}

{% for row in projects %}
<div class="project_container">
    <div class="card" style="text-align:left;">
        <h5 class="card-header"><a href="/projects/{{ row['project_id'] }}">{{ row["project_name"] }}</a></h5>
        <div class="card-body">
            {% if row['year'] != 0 %}
                <p><b>Year: </b>{{ row['year'] }}</p>
            {% endif %}
            
            {% if row['release_date'] != '' %}
                <p><b>Release Date: </b>{{ row['release_date'] }}</p>
            {% elif row['start_date'] != '' %}
                <p><b>Dates: </b>{{ row['start_date'] }} - {{ row['end_date'] }}</p>
            {% endif %}
            {% if row['author_names']|length < 400 %}
                <p class="card-text"><b>Contributors:</b>{{ row["author_names"] }}</p>
            {% else %}
                <p class="card-text">
                    <b>Contributors:</b>
                    {{ row["author_names"][:400] }}<span id="points">...</span><span class="more_authors" id="more_authors" style="display: none;">{{ row["author_names"][400:] }}</span>
                    <br>
                    <a class="author_btn">
                        Show More
                    </a>
                </p>
            {% endif %}

            {% if row["primary_tag"] != '' %}
                <p>
                    <b>Primary Tag:</b>
                    {{row ["primary_tag"]}}
                    <br>
                </p>
            {% endif %}

            {% if row["secondary_tag"] != '' %}
                <p>
                    <b>Secondary Tag:</b>
                    {{row ["secondary_tag"]}}
                    <br>
                </p>
            {% endif %}
            
            {% if row["k_project_id"] %}
                <p><b>Keywords:</b>
                    <span class="keyword_container">
                        {% for keyword in keywords %}
                            {% if keyword['project_id'] == row['project_id'] %}
                                <a href="/keywords/{{ keyword['keyword_name'] }}">{{ keyword['keyword_name'] }}</a><span id="comma">,</span>
                            {% endif %}
                        {% endfor %}
                    </span>
                </p>
            {% endif %}

            {% if row['type_name'] %}
            <p><b>Type: </b>{{ row['type_name'] }}</p>
            {% endif %}
            
            <p><b>URL: </b><a href="{{ row['url'] }}" target="_blank" rel="noopener noreferrer">{{ row['url'] }}</a></p>
            
            {% if row['statement'] !=  '' %}
            <a class="btn btn-link shadow-none" data-toggle="collapse" href="#collapse{{ row['project_id'] }}" aria-expanded="false" aria-controls="collapse{{ row['project_id'] }}">
                Show Summary
            </a>
            <div class="collapse" id="collapse{{ row['project_id'] }}">
                <p>
                    {{ row['statement'] }}
                </p>
            </div>
            {% endif %}
        </div>
    </div>
    <br>
</div>
{% endfor %}


{% endblock %}